# üê≥ –ê–Ω–∞–ª–∏–∑ Docker —Ä–µ—Å—É—Ä—Å–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `docker-analysis.sh` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Docker –∏ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –ª–∏—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã, –∑–∞–Ω–∏–º–∞—é—â–∏–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ disk-manager.sh (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Docker
./scripts/server/disk-manager.sh docker

# –ò–ª–∏ —Å sudo (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞)
sudo ./scripts/server/disk-manager.sh docker
```

### –ù–∞–ø—Ä—è–º—É—é

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
./scripts/server/docker-analysis.sh

# –ò–ª–∏ —Å sudo
sudo ./scripts/server/docker-analysis.sh
```

## üìä –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

### 1. –û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö Docker —Ä–µ—Å—É—Ä—Å–æ–≤
- –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, volumes, build cache

### 2. –í—Å–µ –æ–±—Ä–∞–∑—ã
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–∑–º–µ—Ä—É
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Ç–µ–≥, ID, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, —Ä–∞–∑–º–µ—Ä

### 3. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã (dangling)
- –û–±—Ä–∞–∑—ã –±–µ–∑ —Ç–µ–≥–æ–≤ –∏–ª–∏ —Å —Ç–µ–≥–æ–º `<none>`
- –û–±—ã—á–Ω–æ –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤

### 4. –û–±—Ä–∞–∑—ã –±–µ–∑ —Ç–µ–≥–æ–≤ (untagged)
- –û–±—Ä–∞–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

### 5. –°—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
- –û–±—Ä–∞–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–æ–ª–µ–µ 30 –¥–Ω–µ–π

### 6. –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
- –°—Ç–∞—Ç—É—Å, –æ–±—Ä–∞–∑, —Ä–∞–∑–º–µ—Ä

### 7. –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "exited"
- –ó–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

### 8. Volumes (—Ç–æ–º–∞)
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö volumes
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes (dangling)

### 9. Networks (—Å–µ—Ç–∏)
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ç–µ–π
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏

### 10. Build Cache
- –†–∞–∑–º–µ—Ä –∫—ç—à–∞ —Å–±–æ—Ä–∫–∏ Docker
- –ú–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### 11. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

### 12. –†–∞–∑–º–µ—Ä Docker –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –†–∞–∑–º–µ—Ä `/var/lib/docker`
- –¢–æ–ø –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ —Ä–∞–∑–º–µ—Ä—É

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑

```bash
./scripts/server/disk-manager.sh docker
```

### –ê–Ω–∞–ª–∏–∑ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
./scripts/server/disk-manager.sh docker > /tmp/docker-analysis-$(date +%Y%m%d-%H%M%S).txt
cat /tmp/docker-analysis-*.txt
```

### –ê–Ω–∞–ª–∏–∑ –≤ —Ä–∞–º–∫–∞—Ö –æ–±—â–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –û–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–≤–∫–ª—é—á–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Docker)
./scripts/server/disk-manager.sh diagnose

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Docker
./scripts/server/disk-manager.sh docker
```

## üßπ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
11. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ß–ò–°–¢–ö–ï:
---
–ù–∞–π–¥–µ–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –æ—á–∏—Å—Ç–∫–∏:
  1. –£–¥–∞–ª–∏—Ç—å dangling –æ–±—Ä–∞–∑—ã: docker image prune -af (–æ—Å–≤–æ–±–æ–¥–∏—Ç ~500MB)
  2. –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: docker container prune -f
  3. –û—á–∏—Å—Ç–∏—Ç—å build cache: docker builder prune -af

–ò–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É:
  docker system prune -af --volumes
```

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –ù–ï —É–¥–∞–ª—è–µ—Ç –Ω–∏—á–µ–≥–æ**, —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

–î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- `sudo ./scripts/server/disk-manager.sh cleanup` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
- –ò–ª–∏ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å–∫—Ä–∏–ø—Ç–∞

## üìù –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

### –õ–∏—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å:

1. **Dangling –æ–±—Ä–∞–∑—ã** - –æ–±—Ä–∞–∑—ã –±–µ–∑ —Ç–µ–≥–æ–≤
   ```bash
   docker image prune -af
   ```

2. **–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "exited"
   ```bash
   docker container prune -f
   ```

3. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes** - —Ç–æ–º–∞ –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
   ```bash
   docker volume prune -f
   ```

4. **Build cache** - –∫—ç—à —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤
   ```bash
   docker builder prune -af
   ```

5. **–°—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã** - –æ–±—Ä–∞–∑—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
   ```bash
   docker image prune -af --filter "until=720h"
   ```

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ:

```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Å—ë –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ (–∫—Ä–æ–º–µ volumes)
docker system prune -af

# –£–¥–∞–ª–∏—Ç—å –≤—Å—ë –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ (–≤–∫–ª—é—á–∞—è volumes)
docker system prune -af --volumes
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`sudo ./scripts/server/disk-manager.sh setup`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞:

- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ** (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 3:00) - –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- **–ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —É—Ä–æ–≤–Ω–µ –¥–∏—Å–∫–∞** (>95%) - —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å—Ç–∞—Ä—à–µ 72 —á–∞—Å–æ–≤

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
=== –ê–ù–ê–õ–ò–ó –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø DOCKER ===

1. –û–ë–©–ï–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï DOCKER:
---
TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
Images          15        8         2.5GB     1.2GB (48%)
Containers      12        3         500MB     300MB (60%)
Local Volumes   5         3         200MB     50MB (25%)
Build Cache     0         0         0B        0B

3. –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –û–ë–†–ê–ó–´ (dangling):
---
–ù–∞–π–¥–µ–Ω–æ dangling –æ–±—Ä–∞–∑–æ–≤: 5
REPOSITORY   TAG       IMAGE ID       SIZE
<none>       <none>    abc123def456   200MB
...

11. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ß–ò–°–¢–ö–ï:
---
–ù–∞–π–¥–µ–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –æ—á–∏—Å—Ç–∫–∏:
  1. –£–¥–∞–ª–∏—Ç—å dangling –æ–±—Ä–∞–∑—ã: docker image prune -af (–æ—Å–≤–æ–±–æ–¥–∏—Ç ~1GB)
  2. –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: docker container prune -f
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ
- ‚úÖ –†–∞–∑–º–µ—Ä Docker –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

## üö® –ï—Å–ª–∏ Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

–ï—Å–ª–∏ Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç:
```
‚ö†Ô∏è  Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑
```

–ò –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ –æ—à–∏–±–æ–∫.

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `./scripts/server/disk-manager.sh diagnose` - –æ–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–≤–∫–ª—é—á–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Docker)
- `./scripts/server/disk-manager.sh cleanup` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞–µ—Ç Docker)
- `./scripts/server/disk-manager.sh status` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

