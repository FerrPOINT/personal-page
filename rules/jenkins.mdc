---
description: "–ü—Ä–∞–≤–∏–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Jenkins CI/CD Pipeline –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è"
globs: ["Jenkinsfile", "deploy.sh", "**/jenkins*.qmd", "**/jenkins*.md"]
alwaysApply: false
---

# Jenkins CI/CD Pipeline Setup Rules

## üéØ –û–±–∑–æ—Ä Jenkins CI/CD Pipeline

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jenkins –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main –≤–µ—Ç–∫—É.
Pipeline –≤—ã–ø–æ–ª–Ω—è–µ—Ç: checkout ‚Üí validate ‚Üí deploy –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH.

### üìã –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

**Jenkins Server:**
- URL: `http://192.168.1.49:32768/`
- Job Name: `personal-page-deploy`
- **–í–ê–ñ–ù–û:** API Token —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Jenkins API

**Deployment Server:**
- SSH –∫–æ–º–∞–Ω–¥–∞: `ssh -i ~/.ssh/id_rsa root@azhukov-dev`
- Host: `azhukov-dev` (–∏–ª–∏ `7eb10d5af2ad.vps.myjino.ru:49233`)
- User: `root`
- Path: `/opt/personal-page`

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
GitHub Push ‚Üí Jenkins Webhook ‚Üí Jenkins Pipeline ‚Üí SSH to Server ‚Üí deploy.sh ‚Üí Docker Compose
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `Jenkinsfile` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pipeline –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- `deploy.sh` - —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- SSH credentials –≤ Jenkins (ID: `jenkins-ssh-deploy-key`)
- Docker Compose –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Jenkinsfile

–°–æ–∑–¥–∞–π `Jenkinsfile` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```groovy
pipeline {
    agent any
    
    environment {
        DEPLOY_HOST = 'your-server.example.com'
        DEPLOY_PORT = '22'
        DEPLOY_USER = 'root'
        DEPLOY_PATH = '/opt/your-project'
        COMPOSE_PROJECT_NAME = 'your-project'
    }
    
    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
        timeout(time: 30, unit: 'MINUTES')
        timestamps()
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Jenkins –±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
    triggers {
        pollSCM('H/10 * * * *')
    }
    
    stages {
        stage('Checkout') {
            steps {
                script {
                    echo "üîÑ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
                    checkout scm
                }
            }
        }
        
        stage('Validate') {
            steps {
                script {
                    echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
                    sh 'test -f Jenkinsfile && echo "‚úÖ Jenkinsfile –Ω–∞–π–¥–µ–Ω" || exit 1'
                }
            }
        }
        
        stage('Deploy') {
            steps {
                script {
                    echo "üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä ${DEPLOY_HOST}:${DEPLOY_PORT}..."
                    
                    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ Jenkins Credentials
                    // –ï—Å–ª–∏ credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                    // deploy.sh –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    def telegramBotToken = ''
                    def telegramUserId = ''
                    
                    try {
                        withCredentials([string(credentialsId: 'telegram-bot-token', variable: 'TELEGRAM_BOT_TOKEN')]) {
                            telegramBotToken = env.TELEGRAM_BOT_TOKEN ?: ''
                        }
                    } catch (Exception e) {
                        echo "‚ö†Ô∏è  telegram-bot-token credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
                    }
                    
                    try {
                        withCredentials([string(credentialsId: 'telegram-user-id', variable: 'TELEGRAM_USER_ID')]) {
                            telegramUserId = env.TELEGRAM_USER_ID ?: ''
                        }
                    } catch (Exception e) {
                        echo "‚ö†Ô∏è  telegram-user-id credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
                    }
                    
                    withCredentials([sshUserPrivateKey(
                        credentialsId: 'jenkins-ssh-deploy-key',
                        keyFileVariable: 'SSH_KEY',
                        usernameVariable: 'SSH_USER'
                    )]) {
                        sh """
                            SSH_PORT_FLAG=""
                            if [ "${DEPLOY_PORT}" != "22" ]; then
                                SSH_PORT_FLAG="-p ${DEPLOY_PORT}"
                            fi
                            
                            # BEST PRACTICE: –ü–µ—Ä–µ–¥–∞–µ–º —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
                            # deploy.sh –æ–±–Ω–æ–≤–∏—Ç .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞–Ω—ã
                            ssh -o StrictHostKeyChecking=no -i \${SSH_KEY} \${SSH_PORT_FLAG} ${DEPLOY_USER}@${DEPLOY_HOST} \\
                                "cd ${DEPLOY_PATH} && \\
                                 git fetch origin && \\
                                 git checkout -f origin/main || git checkout -f origin/master && \\
                                 chmod +x deploy.sh && \\
                                 TELEGRAM_BOT_TOKEN='${telegramBotToken ?: ''}' \\
                                 TELEGRAM_USER_ID='${telegramUserId ?: ''}' \\
                                 bash deploy.sh"
                        """
                    }
                }
            }
        }
    }
    
    post {
        success {
            echo "‚úÖ Pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        }
        failure {
            echo "‚ùå Pipeline –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
        }
    }
}
```

**–í–∞–∂–Ω–æ:** –ò–∑–º–µ–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `DEPLOY_HOST`, `DEPLOY_PORT`, `DEPLOY_USER`, `DEPLOY_PATH`, `COMPOSE_PROJECT_NAME` –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è

–°–æ–∑–¥–∞–π `deploy.sh` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
#!/bin/bash
set -e

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
if [ -f env.prod ]; then
    cp env.prod .env
    echo "‚úÖ env.prod —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ .env"
fi

# –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã —á–µ—Ä–µ–∑ Jenkins)
# BEST PRACTICE: –°–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã
if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ "$TELEGRAM_BOT_TOKEN" != "your_bot_token_here" ]; then
    if grep -q "^TELEGRAM_BOT_TOKEN=" .env 2>/dev/null; then
        sed -i "s|^TELEGRAM_BOT_TOKEN=.*|TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}|" .env
    else
        echo "TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}" >> .env
    fi
    echo "  üîê TELEGRAM_BOT_TOKEN –æ–±–Ω–æ–≤–ª–µ–Ω –∏–∑ Jenkins Credentials"
fi
if [ -n "$TELEGRAM_USER_ID" ] && [ "$TELEGRAM_USER_ID" != "your_user_id_here" ]; then
    if grep -q "^TELEGRAM_USER_ID=" .env 2>/dev/null; then
        sed -i "s|^TELEGRAM_USER_ID=.*|TELEGRAM_USER_ID=${TELEGRAM_USER_ID}|" .env
    else
        echo "TELEGRAM_USER_ID=${TELEGRAM_USER_ID}" >> .env
    fi
    echo "  üîê TELEGRAM_USER_ID –æ–±–Ω–æ–≤–ª–µ–Ω –∏–∑ Jenkins Credentials"
fi

echo "üê≥ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker compose down || true

echo "üî® –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker compose up -d --build

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 5

echo "üóÑÔ∏è  –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
docker compose exec -T backend npm run migrate || echo "‚ö†Ô∏è  –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–∞"

echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker compose ps

echo "üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 3

if curl -f http://localhost:9000/health > /dev/null 2>&1; then
    echo "‚úÖ Backend health check: OK"
else
    echo "‚ùå Backend health check: FAILED"
    docker compose logs --tail=50 backend
    exit 1
fi

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
```

**–í–∞–∂–Ω–æ:** –ê–¥–∞–ø—Ç–∏—Ä—É–π health check endpoint –∏ –∫–æ–º–∞–Ω–¥—ã –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins

**–®–∞–≥–∏:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–ª–∞–≥–∏–Ω—ã: Pipeline, Git, SSH Agent, Credentials Binding
2. –°–æ–∑–¥–∞–π SSH credentials:
   - ID: `jenkins-ssh-deploy-key` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
   - Kind: SSH Username with private key
   - Username: `root` (–∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
   - Private Key: –≤—Å—Ç–∞–≤—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
3. –°–æ–∑–¥–∞–π Secret text credentials –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   - **`telegram-bot-token`** (—Ç–∏–ø: Secret text)
     - –ó–Ω–∞—á–µ–Ω–∏–µ: production —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)
     - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - **`telegram-user-id`** (—Ç–∏–ø: Secret text)
     - –ó–Ω–∞—á–µ–Ω–∏–µ: User ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `754334329`)
4. –ù–∞—Å—Ç—Ä–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã:
   - –î–æ–±–∞–≤—å `pollSCM('H/10 * * * *')` –≤ Jenkinsfile –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π GitHub Webhook (–µ—Å–ª–∏ Jenkins –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
5. –ù–∞—Å—Ç—Ä–æ–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å Jenkins (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –ß–µ—Ä–µ–∑ Script Console: `TimeZone.setDefault(TimeZone.getTimeZone("Asia/Novosibirsk"))`
   - –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞: `timedatectl set-timezone Asia/Novosibirsk`
6. –°–æ–∑–¥–∞–π Pipeline Job:
   - Name: `<project-name>-deploy`
   - Definition: Pipeline script from SCM
   - SCM: Git
   - Repository URL: URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   - Script Path: `Jenkinsfile`
   - Triggers: Poll SCM (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è webhook)

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–µ–ø–ª–æ—è

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è:
mkdir -p /opt/your-project
cd /opt/your-project
git clone <repo-url> .
cp env.example.txt env.prod
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π env.prod —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
chmod +x deploy.sh
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- SSH –¥–æ—Å—Ç—É–ø —Å root –ø—Ä–∞–≤–∞–º–∏
- –ü—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys`

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ `main` –≤–µ—Ç–∫—É (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω webhook).

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–ß–µ—Ä–µ–∑ Jenkins UI:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://<JENKINS_URL>/job/personal-page-deploy`
2. –ù–∞–∂–º–∏—Ç–µ **Build Now**

**–ß–µ—Ä–µ–∑ REST API:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

JOB_NAME="personal-page-deploy"

# –ó–∞–ø—É—Å–∫ build
RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
    -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/build")

HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "201" ]; then
    echo "‚úÖ Build –∑–∞–ø—É—â–µ–Ω!"
    echo "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ: $JENKINS_URL/job/$JOB_NAME"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ build (HTTP: $HTTP_CODE)"
fi
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–ß–µ—Ä–µ–∑ REST API:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

JOB_NAME="personal-page-deploy"

# –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
LAST_BUILD_INFO=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/lastBuild/api/json?tree=number,result,url,building")

BUILD_NUMBER=$(echo "$LAST_BUILD_INFO" | grep -o '"number":[0-9]*' | cut -d':' -f2)
RESULT=$(echo "$LAST_BUILD_INFO" | grep -o '"result":"[^"]*"' | cut -d'"' -f4)
BUILDING=$(echo "$LAST_BUILD_INFO" | grep -o '"building":true' || echo "")

if [ -n "$BUILD_NUMBER" ]; then
    echo "Build #$BUILD_NUMBER"
    [ -n "$BUILDING" ] && echo "–°—Ç–∞—Ç—É—Å: üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ" || echo "–°—Ç–∞—Ç—É—Å: $RESULT"
    echo "URL: $JENKINS_URL/job/$JOB_NAME/$BUILD_NUMBER"
else
    echo "Build –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
echo ""
echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤:"
curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/lastBuild/consoleText" | tail -50
```

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ build –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

JOB_NAME="personal-page-deploy"

# –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
LAST_BUILD=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/api/json?tree=lastBuild[number]" | \
    grep -o '"number":[0-9]*' | cut -d':' -f2)

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/$LAST_BUILD/logText/progressiveText?start=0" | \
    tail -f
```

## üêõ Troubleshooting

### "Could not find credentials entry"
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ credentials —Å–æ–∑–¥–∞–Ω—ã —Å ID `jenkins-ssh-deploy-key`
- –ü—Ä–æ–≤–µ—Ä—å Scope credentials (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Global)

### "Permission denied (publickey)"
- –î–æ–±–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `ssh-copy-id -i ~/.ssh/id_ed25519.pub -p <PORT> root@<HOST>`
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á: `chmod 600 ~/.ssh/id_ed25519`

### "docker-compose: not found"
- –ò—Å–ø–æ–ª—å–∑—É–π `docker compose` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞) –≤ —Å–∫—Ä–∏–ø—Ç–µ
- –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏ Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### Build –∑–∞–≤–∏—Å–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–π–º–∞—É—Ç –≤ Jenkinsfile (—É–≤–µ–ª–∏—á—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –¥–µ–ø–ª–æ—è
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker compose logs`

### "telegram-bot-token credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ credentials —Å–æ–∑–¥–∞–Ω—ã —Å ID `telegram-bot-token` –≤ Jenkins
- –ü—Ä–æ–≤–µ—Ä—å Scope credentials (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Global)
- –ï—Å–ª–∏ credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, deploy.sh –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production —Å—Ä–µ–¥–æ–π
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Ä–∞–∑–Ω—ã–µ –±–æ—Ç—ã:
  - –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç: –≤ `env.local` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
  - Production –±–æ—Ç: –≤ Jenkins Credentials `telegram-bot-token`
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `env.local` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.gitignore`)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü–æ–ª–Ω—ã–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞:**
- `info/jenkins-cicd-setup-guide.qmd` - –ø–æ–ª–Ω–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `info/jenkins-quick-reference.qmd` - –±—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞
- `info/jenkins-pipeline.qmd` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ pipeline

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] Jenkinsfile —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] deploy.sh —Å–æ–∑–¥–∞–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- [ ] SSH credentials —Å–æ–∑–¥–∞–Ω—ã –≤ Jenkins (ID: `jenkins-ssh-deploy-key`)
- [ ] Secret text credentials —Å–æ–∑–¥–∞–Ω—ã –≤ Jenkins:
  - [ ] `telegram-bot-token` (production —Ç–æ–∫–µ–Ω –±–æ—Ç–∞)
  - [ ] `telegram-user-id` (User ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
- [ ] Pipeline Job —Å–æ–∑–¥–∞–Ω –≤ Jenkins
- [ ] Poll SCM –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–∏–ª–∏ GitHub Webhook)
- [ ] –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å Jenkins –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è
- [ ] env.prod –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—à–∞–±–ª–æ–Ω, –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤)
- [ ] env.local –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç —Ç–æ–∫–µ–Ω)
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –ü–µ—Ä–≤—ã–π build –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑ Jenkins Credentials –≤ deploy.sh

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è Jenkins
- –ù–µ —Ö—Ä–∞–Ω–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –•—Ä–∞–Ω–∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ Jenkins Credentials, –∞ –Ω–µ –≤ `env.prod` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production —Å—Ä–µ–¥—ã:
  - –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç: –≤ `env.local` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
  - Production –±–æ—Ç: –≤ Jenkins Credentials `telegram-bot-token`
- –û–≥—Ä–∞–Ω–∏—á—å –¥–æ—Å—Ç—É–ø –∫ Jenkins UI
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π SSH –∫–ª—é—á–∏ –∏ API —Ç–æ–∫–µ–Ω—ã
- –ù–µ –ª–æ–≥–∏—Ä—É–π —Å–µ–∫—Ä–µ—Ç—ã –≤ Jenkins console output

## üí° –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Credentials ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω:** `jenkins-ssh-deploy-key` –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤ Jenkinsfile –∏ Jenkins UI
2. **Secret credentials ID –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã:** `telegram-bot-token`, `telegram-user-id` –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤ Jenkinsfile –∏ Jenkins UI
3. **–ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É:** `deploy.sh` –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
4. **–ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:** `chmod +x deploy.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
5. **–í–µ—Ç–∫–∞:** Pipeline –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `origin/main` –∏–ª–∏ `origin/master` (–∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç)
6. **Health check:** –ê–¥–∞–ø—Ç–∏—Ä—É–π endpoint –∏ –ø–æ—Ä—Ç –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
7. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ—Ç–æ–≤:** –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–Ω—ã–µ –±–æ—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production —Å—Ä–µ–¥—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
8. **Poll SCM –∏–Ω—Ç–µ—Ä–≤–∞–ª:** –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Jenkins –±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–π `pollSCM('H/10 * * * *')` (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
9. **Fallback –Ω–∞ .env:** –ï—Å–ª–∏ credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, deploy.sh –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üéØ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

1. –°–∫–æ–ø–∏—Ä—É–π `Jenkinsfile` –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –°–æ–∑–¥–∞–π `deploy.sh` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞
3. –ù–∞—Å—Ç—Ä–æ–π Jenkins credentials:
   - SSH credentials: `jenkins-ssh-deploy-key`
   - Secret text credentials: `telegram-bot-token`, `telegram-user-id`
4. –ù–∞—Å—Ç—Ä–æ–π `env.local` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ –∫–æ–º–º–∏—Ç—å!)
5. –ù–∞—Å—Ç—Ä–æ–π `env.prod` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—à–∞–±–ª–æ–Ω, –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤)
6. –ù–∞—Å—Ç—Ä–æ–π Jenkins Job –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã (pollSCM –∏–ª–∏ webhook)
7. –ü–æ–¥–≥–æ—Ç–æ–≤—å —Å–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è
8. –ó–∞–ø—É—Å—Ç–∏ –ø–µ—Ä–≤—ã–π build –∏ –ø—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
9. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑ Jenkins Credentials –≤ deploy.sh

## üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Jenkins Credentials

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Jenkins Credentials:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–µ–∫—Ä–µ—Ç—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
3. **–õ–µ–≥–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥:** –†–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–í Jenkinsfile:** –°–µ–∫—Ä–µ—Ç—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `withCredentials([string(...)])`
2. **–ü–µ—Ä–µ–¥–∞—á–∞ –≤ deploy.sh:** –°–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ SSH
3. **–í deploy.sh:** –°–µ–∫—Ä–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã
4. **Fallback:** –ï—Å–ª–∏ credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

1. –°–æ–∑–¥–∞–π Secret text credentials –≤ Jenkins —Å –Ω—É–∂–Ω—ã–º–∏ ID
2. –î–æ–±–∞–≤—å –±–ª–æ–∫ `withCredentials` –≤ Jenkinsfile –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
3. –ü–µ—Ä–µ–¥–∞–π —Å–µ–∫—Ä–µ—Ç—ã –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ SSH –∫–æ–º–∞–Ω–¥—É
4. –û–±–Ω–æ–≤–∏ `deploy.sh` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

---

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–∏–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:**
- `deploy.sh` - **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Jenkinsfile –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ SSH –∏–∑ Jenkins.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Jenkins —É–¥–∞–ª–µ–Ω—ã. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Jenkins —á–µ—Ä–µ–∑ REST API –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ (—Å–º. —Ä–∞–∑–¥–µ–ª—ã –Ω–∏–∂–µ). –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Jenkins API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é.

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–ª–∞–≥–∏–Ω—ã Jenkins

–°–ª–µ–¥—É—é—â–∏–µ –ø–ª–∞–≥–∏–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- **Pipeline** (workflow-aggregator) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Jenkinsfile
- **SSH Pipeline Steps** (ssh-steps) - –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- **Docker Pipeline** (docker-workflow) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Docker
- **Git Plugin** (git) - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
- **SSH Credentials Plugin** (ssh-credentials) - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è SSH –∫–ª—é—á–µ–π

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Jenkins UI:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://<JENKINS_URL>/pluginManager/available`
2. –ù–∞–π–¥–∏—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
3. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Jenkins (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ API:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

PLUGINS=("workflow-aggregator" "ssh-steps" "docker-workflow" "git" "ssh-credentials")
for PLUGIN in "${PLUGINS[@]}"; do
    INSTALLED=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
        "$JENKINS_URL/pluginManager/api/json?depth=1" | \
        grep -o "\"shortName\":\"$PLUGIN\"" || echo "")
    if [ -n "$INSTALLED" ]; then
        echo "‚úÖ $PLUGIN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ùå $PLUGIN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ UI: $JENKINS_URL/pluginManager/available"
    fi
done
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH Credentials

**–ß–µ—Ä–µ–∑ Jenkins UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

1. **Manage Jenkins** ‚Üí **Credentials** ‚Üí **System** ‚Üí **Global credentials**
2. –ù–∞–∂–º–∏—Ç–µ **Add Credentials**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Kind**: SSH Username with private key
   - **ID**: `jenkins-ssh-deploy-key` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
   - **Username**: `root`
   - **Private Key**: –≤—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
4. –ù–∞–∂–º–∏—Ç–µ **OK**

**–ß–µ—Ä–µ–∑ REST API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

# –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
SSH_PRIVATE_KEY=$(cat ~/.ssh/id_rsa)

# –°–æ–∑–¥–∞–π—Ç–µ JSON –¥–ª—è credentials
CREDENTIAL_JSON=$(cat <<EOF
{
  "": "0",
  "credentials": {
    "scope": "GLOBAL",
    "id": "jenkins-ssh-deploy-key",
    "username": "root",
    "usernameSecret": false,
    "privateKeySource": {
      "value": "0",
      "privateKey": "$SSH_PRIVATE_KEY",
      "stapler-class": "com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey\$DirectEntryPrivateKeySource"
    },
    "description": "SSH key for deployment server",
    "stapler-class": "com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey"
  }
}
EOF
)

# –°–æ–∑–¥–∞–π—Ç–µ credentials —á–µ—Ä–µ–∑ API
curl -s -w "\n%{http_code}" -X POST \
  -u "$JENKINS_USER:$JENKINS_TOKEN" \
  -H "Content-Type: application/json" \
  --data "$CREDENTIAL_JSON" \
  "$JENKINS_URL/credentials/store/system/domain/_/createCredentials"
```

**–í–∞–∂–Ω–æ:** –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è:

```bash
ssh-copy-id -i ~/.ssh/id_rsa.pub -p <PORT> root@<HOST>
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/id_rsa.pub | ssh -p <PORT> root@<HOST> "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

**–ß–µ—Ä–µ–∑ Jenkins UI (Script Console):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://<JENKINS_URL>/script`
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```groovy
import jenkins.model.Jenkins
import java.util.TimeZone

TimeZone.setDefault(TimeZone.getTimeZone("Asia/Novosibirsk"))
Jenkins.instance.save()

println "–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + TimeZone.getDefault().getID()
println "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: " + new Date()
```
3. –ù–∞–∂–º–∏—Ç–µ **Run**

**–ß–µ—Ä–µ–∑ REST API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

# Groovy —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
GROOVY_SCRIPT='import jenkins.model.Jenkins; import java.util.TimeZone; TimeZone.setDefault(TimeZone.getTimeZone("Asia/Novosibirsk")); Jenkins.instance.save(); println "–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + TimeZone.getDefault().getID(); println "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: " + new Date();'

# –ü–æ–ª—É—á–∏—Ç–µ CSRF —Ç–æ–∫–µ–Ω
CSRF_CRUMB=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\":\",//crumb)")

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —á–µ—Ä–µ–∑ API
if [ -n "$CSRF_CRUMB" ]; then
    CRUMB_FIELD=$(echo "$CSRF_CRUMB" | cut -d: -f1)
    CRUMB_VALUE=$(echo "$CSRF_CRUMB" | cut -d: -f2)
    curl -s -X POST \
      -u "$JENKINS_USER:$JENKINS_TOKEN" \
      -H "$CRUMB_FIELD: $CRUMB_VALUE" \
      --data-urlencode "script=$GROOVY_SCRIPT" \
      "$JENKINS_URL/scriptText"
else
    curl -s -X POST \
      -u "$JENKINS_USER:$JENKINS_TOKEN" \
      --data-urlencode "script=$GROOVY_SCRIPT" \
      "$JENKINS_URL/scriptText"
fi
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
  "$JENKINS_URL/systemInfo" | grep "user.timezone"
```

### –°–æ–∑–¥–∞–Ω–∏–µ Jenkins Job

**–ß–µ—Ä–µ–∑ Jenkins UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

1. **New Item** ‚Üí **Pipeline**
2. **Name**: `personal-page-deploy`
3. **Pipeline** ‚Üí **Definition**: Pipeline script from SCM
4. **SCM**: Git
5. **Repository URL**: URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
6. **Script Path**: `Jenkinsfile`
7. **Triggers**: Poll SCM (`H/10 * * * *` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
8. **Save**

**–ß–µ—Ä–µ–∑ REST API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

JOB_NAME="personal-page-deploy"
REPO_URL="https://github.com/username/personal-page.git"

# –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ job —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
CURRENT_CONFIG=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/$JOB_NAME/config.xml" 2>/dev/null)

# –ï—Å–ª–∏ job –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ
if [ -z "$CURRENT_CONFIG" ] || echo "$CURRENT_CONFIG" | grep -q "Error"; then
    # –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é job
    JOB_CONFIG=$(cat <<EOF
<?xml version='1.1' encoding='UTF-8'?>
<flow-definition plugin="workflow-job">
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition" plugin="workflow-cps">
    <scm class="hudson.plugins.git.GitSCM" plugin="git">
      <configVersion>2</configVersion>
      <userRemoteConfigs>
        <hudson.plugins.git.UserRemoteConfig>
          <url>$REPO_URL</url>
        </hudson.plugins.git.UserRemoteConfig>
      </userRemoteConfigs>
      <branches>
        <hudson.plugins.git.BranchSpec>
          <name>*/main</name>
        </hudson.plugins.git.BranchSpec>
      </branches>
      <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
      <submoduleCfg class="list"/>
      <extensions/>
    </scm>
    <scriptPath>Jenkinsfile</scriptPath>
    <lightweight>true</lightweight>
  </definition>
  <triggers>
    <hudson.triggers.SCMTrigger>
      <spec>H/10 * * * *</spec>
      <ignorePostCommitHooks>false</ignorePostCommitHooks>
    </hudson.triggers.SCMTrigger>
  </triggers>
</flow-definition>
EOF
)
    
    # –°–æ–∑–¥–∞–π—Ç–µ job —á–µ—Ä–µ–∑ API
    curl -s -w "\n%{http_code}" -X POST \
      -u "$JENKINS_USER:$JENKINS_TOKEN" \
      -H "Content-Type: application/xml" \
      --data-binary "$JOB_CONFIG" \
      "$JENKINS_URL/createItem?name=$JOB_NAME"
fi
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ REST API:**

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ REST API (—Å–º. –ø—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –Ω–∏–∂–µ).

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ REST API (–≤—Ä—É—á–Ω—É—é):**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl -s -f -u "$JENKINS_USER:$JENKINS_TOKEN" \
  "$JENKINS_URL/api/json" > /dev/null && echo "‚úÖ Jenkins –¥–æ—Å—Ç—É–ø–µ–Ω" || echo "‚ùå Jenkins –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
VERSION=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
  "$JENKINS_URL/api/json?tree=version" | grep -o '"version":"[^"]*"' | cut -d'"' -f4)
echo "–í–µ—Ä—Å–∏—è Jenkins: $VERSION"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
PLUGINS=("workflow-aggregator" "ssh-steps" "docker-workflow" "git" "ssh-credentials")
for PLUGIN in "${PLUGINS[@]}"; do
    INSTALLED=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
        "$JENKINS_URL/pluginManager/api/json?depth=1" | \
        grep -o "\"shortName\":\"$PLUGIN\"" || echo "")
    [ -n "$INSTALLED" ] && echo "‚úÖ $PLUGIN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" || echo "‚ùå $PLUGIN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
done

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH credentials
CREDENTIAL_EXISTS=$(curl -s -o /dev/null -w "%{http_code}" \
    -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/credentials/store/system/domain/_/credential/jenkins-ssh-deploy-key/api/json")
[ "$CREDENTIAL_EXISTS" = "200" ] && echo "‚úÖ SSH credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã" || echo "‚ùå SSH credentials –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ job
JOB_EXISTS=$(curl -s -o /dev/null -w "%{http_code}" \
    -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/personal-page-deploy/api/json")
[ "$JOB_EXISTS" = "200" ] && echo "‚úÖ Job —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" || echo "‚ùå Job –Ω–µ –Ω–∞–π–¥–µ–Ω"

# 6. –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
LAST_BUILD=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/personal-page-deploy/api/json?tree=lastBuild[number,result,url]" | \
    grep -o '"number":[0-9]*' | cut -d':' -f2)
if [ -n "$LAST_BUILD" ]; then
    RESULT=$(curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
        "$JENKINS_URL/job/personal-page-deploy/api/json?tree=lastBuild[result]" | \
        grep -o '"result":"[^"]*"' | cut -d'"' -f4)
    echo "–ü–æ—Å–ª–µ–¥–Ω–∏–π build: #$LAST_BUILD, —Ä–µ–∑—É–ª—å—Ç–∞—Ç: $RESULT"
fi
```

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**"Could not find credentials entry"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ credentials —Å–æ–∑–¥–∞–Ω—ã —Å ID `jenkins-ssh-deploy-key`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Scope credentials (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Global)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ API:
  ```bash
  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"
  curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/credentials/store/system/domain/_/credential/jenkins-ssh-deploy-key/api/json"
  ```

**"JENKINS_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥:
  ```bash
  export JENKINS_URL="http://192.168.1.49:32768"
  export JENKINS_USER="ferrpoint"
  export JENKINS_TOKEN="your_token_here"
  ```

**"Permission denied (publickey)"**
- –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
  ```bash
  ssh-copy-id -i ~/.ssh/id_rsa.pub -p <PORT> root@<HOST>
  # –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
  cat ~/.ssh/id_rsa.pub | ssh -p <PORT> root@<HOST> \
    "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
  ```
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á: `chmod 600 ~/.ssh/id_rsa`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "echo 'SSH connection works'"
  ```

**"Build –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—Å–º. —Ä–∞–∑–¥–µ–ª "–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ API" –≤—ã—à–µ)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Jenkinsfile —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Jenkins Console Output:
  ```bash
  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export JENKINS_URL="http://192.168.1.49:32768"
export JENKINS_USER="ferrpoint"
export JENKINS_TOKEN="your_token_here"
  curl -s -u "$JENKINS_USER:$JENKINS_TOKEN" \
    "$JENKINS_URL/job/personal-page-deploy/lastBuild/consoleText" | tail -100
  ```

**"Job –Ω–µ –Ω–∞–π–¥–µ–Ω"**
- –°–æ–∑–¥–∞–π—Ç–µ job —á–µ—Ä–µ–∑ Jenkins UI –∏–ª–∏ —á–µ—Ä–µ–∑ API (—Å–º. —Ä–∞–∑–¥–µ–ª "–°–æ–∑–¥–∞–Ω–∏–µ Jenkins Job")
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–º—è job —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `JOB_NAME` –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö: `personal-page-deploy`

**"–ü–ª–∞–≥–∏–Ω—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è"**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ Jenkins
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ UI: `http://<JENKINS_URL>/pluginManager/available`
- –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Jenkins (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

**"Build –∑–∞–≤–∏—Å–∞–µ—Ç"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –≤ Jenkinsfile (—É–≤–µ–ª–∏—á—å—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –¥–µ–ø–ª–æ—è:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "echo 'Server is reachable'"
  ```
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "cd /opt/personal-page && docker compose logs --tail=100"
  ```

**"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ deploy.sh"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "chmod +x /opt/personal-page/deploy.sh"
  ```
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "docker --version && docker compose version"
  ```
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ deploy.sh –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  ```bash
  ssh -i ~/.ssh/id_rsa -p <PORT> root@<HOST> "cd /opt/personal-page && bash -x deploy.sh 2>&1 | tail -50"
  ```
