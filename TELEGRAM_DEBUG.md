# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å Telegram –±–æ—Ç–æ–º

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–ü–æ –¥–∞–Ω–Ω—ã–º API `/api/telegram/status`:
- ‚úÖ `tokenConfigured: true` - —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `tokenLength: 46` - –¥–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
- ‚úÖ `userIdConfigured: true` - user ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `chatIdRegistered: true` - chat ID –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- ‚ùå `botConnected: false` - **–ë–û–¢ –ù–ï –ü–û–î–ö–õ–Æ–ß–ï–ù**
- ‚ùå `botUsername: null` - –Ω–µ—Ç username –±–æ—Ç–∞
- ‚ö†Ô∏è `error: null` - –æ—à–∏–±–∫–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ)

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–¢–æ–∫–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫**
   - –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º
   - –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–æ–∑–≤–∞–Ω –≤ BotFather
   - –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏–ª–∏ —Å–∏–º–≤–æ–ª—ã

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ Jenkins**
   - Credentials –≤ Jenkins –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ SSH
   - –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å placeholder

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é/–¥–æ—Å—Ç—É–ø–æ–º –∫ Telegram API**
   - –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∫ api.telegram.org
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ firewall

4. **–ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞**
   - –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ TelegramBot
   - –û—à–∏–±–∫–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ `backend/src/services/telegram.ts`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ (–¥–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–∞, –ø—Ä–µ—Ñ–∏–∫—Å)
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `testTelegramConnectionWithDetails`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω, –ø–æ—á–µ–º—É –±–æ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

### 2. –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ `backend/src/index.ts`
- –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ endpoint

### 3. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `deploy.sh`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏–Ω—ã –∏ –ø—Ä–µ—Ñ–∏–∫—Å–∞ —Ç–æ–∫–µ–Ω–∞ (–±–µ–∑ —Å–∞–º–æ–≥–æ —Ç–æ–∫–µ–Ω–∞)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç placeholder

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials –≤ Jenkins

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://192.168.1.49:32768/
2. –í–æ–π–¥–∏—Ç–µ: `ferrpoint` / —Ç–æ–∫–µ–Ω `1191a9f019fc3989d7a5ff30d456fb9cf3`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Manage Jenkins** ‚Üí **Credentials** ‚Üí **System** ‚Üí **Global credentials (unrestricted)**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `telegram-bot-token`:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å ID: `telegram-bot-token`
   - Secret –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞—à Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç–µ –≤ @BotFather)
   - –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –¥—Ä—É–≥–æ–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –æ–±–Ω–æ–≤–∏—Ç–µ/—Å–æ–∑–¥–∞–π—Ç–µ

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `telegram-user-id`:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å ID: `telegram-user-id`
   - Secret –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `754334329`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Jenkins –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ build –≤ Jenkins –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```
http://192.168.1.49:32768/job/personal-page-deploy/build
```

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üîê –ü–æ–ª—É—á–µ–Ω TELEGRAM_BOT_TOKEN –∏–∑ Jenkins (–¥–ª–∏–Ω–∞: 46, –ø—Ä–µ—Ñ–∏–∫—Å: [TOKEN_PREFIX]...)
‚úÖ TELEGRAM_BOT_TOKEN –æ–±–Ω–æ–≤–ª–µ–Ω –≤ .env
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚ö†Ô∏è  telegram-bot-token credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚ö†Ô∏è  TELEGRAM_BOT_TOKEN –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –∏–∑ Jenkins (–ø—É—Å—Ç–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è)
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
```bash
ssh -i ~/.ssh/id_rsa root@azhukov-dev
# –∏–ª–∏
ssh -i ~/.ssh/jenkins_deploy_key root@azhukov-dev
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:
```bash
cd /opt/personal-page
docker compose logs --tail=200 backend | grep -i telegram
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
[telegram] Initializing Telegram bot { tokenLength: 46, tokenPrefix: '[TOKEN_PREFIX]...', hasUserId: true }
[telegram] User ID loaded from environment { userId: '754334329' }
[telegram] Telegram bot initialized successfully { userId: '754334329' }
[telegram] Testing Telegram connection... { tokenLength: 46 }
[telegram] Telegram bot connected { username: 'your_bot_username', botId: 123456789 }
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```
[telegram] Error initializing Telegram bot { error: '...', response: '...' }
[telegram] Telegram connection test failed { error: 'Telegram API error: 401 - Unauthorized', ... }
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
cd /opt/personal-page
grep TELEGRAM .env
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_USER_ID=754334329
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_BOT_TOKEN=
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API

```bash
curl -s https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–æ—Ç–µ:
```json
{"ok":true,"result":{"id":123456789,"is_bot":true,"first_name":"Your Bot","username":"your_bot_username",...}}
```

–ï—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–∞—Å—å –æ—à–∏–±–∫–∞ 401 - —Ç–æ–∫–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫.

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
curl -s http://azhukov-dev.ru/api/telegram/status
```

–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è `error` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã, –µ—Å–ª–∏ –±–æ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π build –≤ Jenkins —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Jenkins –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø–µ—Ä–µ–¥–∞—á–µ —Ç–æ–∫–µ–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API —Å —Å–µ—Ä–≤–µ—Ä–∞
6. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π - –æ–±–Ω–æ–≤–∏—Ç—å –≤ BotFather –∏ –≤ Jenkins Credentials

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∞–∫—Ç—É–∞–ª–µ–Ω –≤ BotFather
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ BotFather, –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –∏—Å—Ç–µ–∫
3. –û–±–Ω–æ–≤–∏—Ç—å credentials –≤ Jenkins —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å build –≤ Jenkins
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø –∫ api.telegram.org:443)

