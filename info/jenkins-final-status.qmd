# –°—Ç–∞—Ç—É—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Jenkins CI/CD

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 1. –°–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- **–•–æ—Å—Ç**: `7eb10d5af2ad.vps.myjino.ru:49233`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `root`
- **–ü—É—Ç—å**: `/opt/personal-page`
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
- **Docker**: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Docker Compose**: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Git**: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 2. Jenkinsfile –æ–±–Ω–æ–≤–ª–µ–Ω
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π SSH –ø–æ—Ä—Ç (49233)
- –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è: `scripts/deploy.sh`

### 3. SSH –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≥–æ—Ç–æ–≤ –¥–ª—è Jenkins credentials

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ SSH Credentials –≤ Jenkins

1. –û—Ç–∫—Ä–æ–π—Ç–µ Jenkins: http://192.168.1.49:32768/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Manage Jenkins** ‚Üí **Credentials** ‚Üí **System** ‚Üí **Global credentials (unrestricted)**
3. –ù–∞–∂–º–∏—Ç–µ **Add Credentials**

4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Kind**: `SSH Username with private key`
   - **Scope**: `Global`
   - **ID**: `jenkins-ssh-deploy-key` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
   - **Description**: `SSH key for deployment server`
   - **Username**: `root`
   - **Private Key**: `Enter directly`
   - –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (—Å–º. –Ω–∏–∂–µ)

5. –ù–∞–∂–º–∏—Ç–µ **OK**

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è credentials

```bash
# –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á:
cat ~/.ssh/id_ed25519
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
bash scripts/create-ssh-credentials-manual.sh
```

## üöÄ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ credentials

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π build:

```bash
bash scripts/trigger-jenkins-build.sh
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Jenkins UI:
- http://192.168.1.49:32768/job/personal-page-deploy/
- –ù–∞–∂–º–∏—Ç–µ **Build Now**

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å build:
curl -s -u ferrpoint:1191a9f019fc3989d7a5ff30d456fb9cf3 \
  "http://192.168.1.49:32768/job/personal-page-deploy/lastBuild/api/json?tree=number,result,building"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
curl -s -u ferrpoint:1191a9f019fc3989d7a5ff30d456fb9cf3 \
  "http://192.168.1.49:32768/job/personal-page-deploy/lastBuild/consoleText" | tail -50
```

## üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è

```mermaid
graph LR
    A[GitHub Push] --> B[Jenkins Webhook]
    B --> C[Jenkins Pipeline]
    C --> D[Checkout Code]
    D --> E[SSH to Server]
    E --> F[Run deploy.sh]
    F --> G[Docker Compose]
    G --> H[Application Running]
```

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Jenkinsfile
- **DEPLOY_HOST**: `7eb10d5af2ad.vps.myjino.ru`
- **DEPLOY_PORT**: `49233`
- **DEPLOY_USER**: `root`
- **DEPLOY_PATH**: `/opt/personal-page`
- **Credentials ID**: `jenkins-ssh-deploy-key`

### –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
- **–§–∞–π–ª**: `scripts/deploy.sh`
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ `/opt/personal-page/scripts/deploy.sh`
- **–î–µ–π—Å—Ç–≤–∏—è**:
  1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ Git
  2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ env.prod –≤ .env
  3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  4. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  5. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
  6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è credentials –≤ Jenkins, pipeline –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω:

1. Push –≤ GitHub ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π trigger
2. Jenkins –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. Jenkins –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `deploy.sh`
5. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

