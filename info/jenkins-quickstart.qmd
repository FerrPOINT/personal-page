# Jenkins Pipeline - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

Jenkins –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **URL**: `http://192.168.1.49:32768/`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `ferrpoint`
- **–¢–æ–∫–µ–Ω**: `1191a9f019fc3989d7a5ff30d456fb9cf3`

**‚úÖ Jenkins job —É–∂–µ —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**
- **Job**: `personal-page-deploy`
- **URL**: `http://192.168.1.49:32768/job/personal-page-deploy`

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:
```bash
bash scripts/check-jenkins.sh
```

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (5 –º–∏–Ω—É—Ç)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –≤ Jenkins

–ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Manage Jenkins** ‚Üí **Plugins** ‚Üí **Available plugins**

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
- ‚úÖ Pipeline
- ‚úÖ SSH Pipeline Steps
- ‚úÖ Docker Pipeline
- ‚úÖ Git Plugin

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH Credentials

**Manage Jenkins** ‚Üí **Credentials** ‚Üí **System** ‚Üí **Global credentials** ‚Üí **Add Credentials**

- **Kind**: SSH Username with private key
- **ID**: `jenkins-ssh-deploy-key`
- **Username**: `root`
- **Private Key**: –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `7eb10d5af2ad.vps.myjino.ru:49233`

### 3. Pipeline Job —É–∂–µ —Å–æ–∑–¥–∞–Ω ‚úÖ

Job `personal-page-deploy` —É–∂–µ —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ API.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å job**: `http://192.168.1.49:32768/job/personal-page-deploy`

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å job:
```bash
bash scripts/create-jenkins-job.sh "git@github.com:FerrPOINT/personal-page.git"
```

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í GitHub: **Settings** ‚Üí **Webhooks** ‚Üí **Add webhook**

- **Payload URL**: `http://192.168.1.49:32768/github-webhook/`
- **Content type**: `application/json`
- **Events**: Just the push event

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–µ—Ä–≤—ã–π build

–í Jenkins: –û—Ç–∫—Ä–æ–π—Ç–µ job ‚Üí **Build Now**

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Pipeline

```{mermaid}
graph LR
    A[Git Push] --> B[Checkout]
    B --> C[Build Images]
    C --> D[Deploy]
    D --> E[Health Check]
    E --> F[‚úÖ Done]
    
    style A fill:#e1f5ff
    style F fill:#d4edda
```

1. **Checkout** - –∫–ª–æ–Ω–∏—Ä—É–µ—Ç –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. **Build** - —Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
3. **Deploy** - –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH:
   - `git pull` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - `docker compose up -d --build`
   - –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
4. **Health Check** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å —Ñ–∞–π–ª `env.prod`:

```bash
ssh root@7eb10d5af2ad.vps.myjino.ru -p 49233
cd /opt/personal-page
ls -la env.prod
```

–ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example.txt`.

---

## üêõ Troubleshooting

### Jenkins –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø –≤—Ä—É—á–Ω—É—é
ssh -p 49233 root@7eb10d5af2ad.vps.myjino.ru
```

### Job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: **Build** ‚Üí **Console Output**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Jenkinsfile –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git credentials

### –î–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH credentials –≤ Jenkins
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker compose logs`

---

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `info/jenkins-pipeline.qmd` –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ pipeline –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

