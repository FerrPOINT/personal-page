# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Jenkins CI/CD Pipeline

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ CI/CD pipeline –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Jenkins. Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```mermaid
graph TB
    A[GitHub Repository] -->|Webhook| B[Jenkins Server]
    B -->|SSH Connection| C[Deployment Server]
    C -->|Docker Compose| D[Application Containers]
    
    subgraph "Jenkins Pipeline Stages"
        E[Checkout] --> F[Validate]
        F --> G[Deploy]
    end
    
    subgraph "Deployment Server"
        H[Git Pull] --> I[Build Docker Images]
        I --> J[Stop Old Containers]
        J --> K[Start New Containers]
        K --> L[Health Check]
    end
    
    B --> E
    G --> H
```

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –°–µ—Ä–≤–µ—Ä—ã –∏ –¥–æ—Å—Ç—É–ø—ã

#### Jenkins Server
- ‚úÖ Jenkins —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ Jenkins API —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ü–ª–∞–≥–∏–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—Å–º. —Ä–∞–∑–¥–µ–ª "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤")
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ Jenkins UI –∏ API

#### Deployment Server (VPS)
- ‚úÖ SSH –¥–æ—Å—Ç—É–ø —Å root –ø—Ä–∞–≤–∞–º–∏
- ‚úÖ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤–µ—Ä—Å–∏—è 20.10+)
- ‚úÖ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤–µ—Ä—Å–∏—è 2.0+)
- ‚úÖ Git —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞–∑–æ–≤

#### GitHub Repository
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω (–ø—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º)
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ (main –∏–ª–∏ master)

### 2. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

```
project-root/
‚îú‚îÄ‚îÄ Jenkinsfile              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jenkins pipeline
‚îú‚îÄ‚îÄ docker-compose.yml       # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ deploy.sh            # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚îú‚îÄ‚îÄ .env.example             # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ [Dockerfile's]           # Dockerfile –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
```

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ SSH –∫–ª—é—á–∞

#### 1.1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –Ω–µ—Ç)

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞
ssh-keygen -t ed25519 -C "jenkins-deploy" -f ~/.ssh/jenkins_deploy_key

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª—é—á–∞
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 600 ~/.ssh/id_ed25519
```

#### 1.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/id_ed25519.pub -p <SSH_PORT> root@<DEPLOY_HOST>

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/id_ed25519.pub | ssh -p <SSH_PORT> root@<DEPLOY_HOST> \
  "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

#### 1.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
ssh -i ~/.ssh/id_ed25519 -p <SSH_PORT> root@<DEPLOY_HOST> "echo 'SSH connection OK'"
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins

#### 2.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤

```bash
# –°–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
PLUGINS="workflow-aggregator git credentials-binding ssh-agent"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Jenkins CLI –∏–ª–∏ UI
# Manage Jenkins ‚Üí Plugins ‚Üí Available plugins
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:**
- `Pipeline` (workflow-aggregator)
- `Git` plugin
- `SSH Agent` plugin
- `Credentials Binding` plugin

#### 2.2. –°–æ–∑–¥–∞–Ω–∏–µ SSH Credentials –≤ Jenkins

1. –û—Ç–∫—Ä–æ–π—Ç–µ Jenkins: `http://<JENKINS_HOST>:<PORT>/`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Manage Jenkins** ‚Üí **Credentials** ‚Üí **System** ‚Üí **Global credentials (unrestricted)**
3. –ù–∞–∂–º–∏—Ç–µ **Add Credentials**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **Kind**: `SSH Username with private key`
- **Scope**: `Global`
- **ID**: `jenkins-ssh-deploy-key` (–≤–∞–∂–Ω–æ! –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Jenkinsfile)
- **Description**: `SSH key for deployment server`
- **Username**: `root` (–∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- **Private Key**: `Enter directly` ‚Üí –≤—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á

**–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:**
```bash
cat ~/.ssh/id_ed25519
```

#### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ Pipeline Job

**–ß–µ—Ä–µ–∑ UI:**
1. **New Item** ‚Üí **Pipeline**
2. **Name**: `<project-name>-deploy`
3. **Pipeline** ‚Üí **Definition**: `Pipeline script from SCM`
4. **SCM**: `Git`
5. **Repository URL**: `https://github.com/<user>/<repo>.git`
6. **Credentials**: (–µ—Å–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
7. **Branches to build**: `*/main` –∏–ª–∏ `*/master`
8. **Script Path**: `Jenkinsfile`
9. **Save**

**–ß–µ—Ä–µ–∑ API (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è):**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç create-jenkins-job.sh
bash scripts/create-jenkins-job.sh https://github.com/user/repo.git
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ Jenkinsfile

#### 3.1. –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Jenkinsfile

```groovy
pipeline {
    agent any
    
    environment {
        // SSH connection settings
        DEPLOY_HOST = 'your-server.example.com'  // –•–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–µ–ø–ª–æ—è
        DEPLOY_PORT = '22'                        // SSH –ø–æ—Ä—Ç (22 –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π)
        DEPLOY_USER = 'root'                      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        DEPLOY_PATH = '/opt/your-project'         // –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        
        // Docker Compose settings
        COMPOSE_PROJECT_NAME = 'your-project'    // –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è Docker Compose
    }
    
    options {
        // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–±–æ—Ä–æ–∫
        buildDiscarder(logRotator(numToKeepStr: '10'))
        // –¢–∞–π–º–∞—É—Ç –¥–ª—è –≤—Å–µ–≥–æ pipeline (30 –º–∏–Ω—É—Ç)
        timeout(time: 30, unit: 'MINUTES')
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–π–º—Å—Ç–∞–º–ø—ã –≤ –ª–æ–≥–∞—Ö
        timestamps()
    }
    
    stages {
        stage('Checkout') {
            steps {
                script {
                    echo "üîÑ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
                    checkout scm
                    sh 'git rev-parse HEAD > .git/commit-hash'
                    sh 'cat .git/commit-hash'
                }
            }
        }
        
        stage('Validate') {
            steps {
                script {
                    echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
                    sh 'test -f Jenkinsfile && echo "‚úÖ Jenkinsfile –Ω–∞–π–¥–µ–Ω" || (echo "‚ùå Jenkinsfile –Ω–µ –Ω–∞–π–¥–µ–Ω" && exit 1)'
                    echo "‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
                }
            }
        }
        
        stage('Deploy') {
            steps {
                script {
                    echo "üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä ${DEPLOY_HOST}:${DEPLOY_PORT}..."
                    
                    withCredentials([sshUserPrivateKey(
                        credentialsId: 'jenkins-ssh-deploy-key',
                        keyFileVariable: 'SSH_KEY',
                        usernameVariable: 'SSH_USER'
                    )]) {
                        sh """
                            # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è
                            SSH_PORT_FLAG=""
                            if [ "${DEPLOY_PORT}" != "22" ]; then
                                SSH_PORT_FLAG="-p ${DEPLOY_PORT}"
                            fi
                            
                            ssh -o StrictHostKeyChecking=no -i \${SSH_KEY} \${SSH_PORT_FLAG} ${DEPLOY_USER}@${DEPLOY_HOST} \\
                                "cd ${DEPLOY_PATH} && \\
                                 git fetch origin && \\
                                 git checkout -f origin/main || git checkout -f origin/master && \\
                                 chmod +x scripts/deploy.sh && \\
                                 bash scripts/deploy.sh"
                        """
                    }
                }
            }
        }
    }
    
    post {
        success {
            script {
                echo "‚úÖ Pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
            }
        }
        failure {
            script {
                echo "‚ùå Pipeline –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
            }
        }
        always {
            script {
                echo "üìã –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
                sh 'rm -f .git/commit-hash || true'
            }
        }
    }
}
```

#### 3.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ò–∑–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç:

```groovy
environment {
    DEPLOY_HOST = 'your-server.example.com'     // ‚¨ÖÔ∏è –í–∞—à —Å–µ—Ä–≤–µ—Ä
    DEPLOY_PORT = '22'                           // ‚¨ÖÔ∏è –í–∞—à SSH –ø–æ—Ä—Ç
    DEPLOY_USER = 'root'                         // ‚¨ÖÔ∏è –í–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    DEPLOY_PATH = '/opt/your-project'            // ‚¨ÖÔ∏è –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
    COMPOSE_PROJECT_NAME = 'your-project'        // ‚¨ÖÔ∏è –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞
}
```

**–í–∞–∂–Ω–æ:** `credentialsId: 'jenkins-ssh-deploy-key'` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å ID credentials –≤ Jenkins!

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è

#### 4.1. –°–∫—Ä–∏–ø—Ç `scripts/deploy.sh`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scripts/deploy.sh` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
#!/bin/bash
set -e

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
if [ -f env.prod ]; then
    cp env.prod .env
    echo "‚úÖ env.prod —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ .env"
else
    echo "‚ö†Ô∏è  env.prod –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π .env"
fi

echo "üê≥ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
if command -v docker-compose &> /dev/null; then
    docker-compose down || true
else
    docker compose down || true
fi

echo "üî® –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
if command -v docker-compose &> /dev/null; then
    docker-compose up -d --build
else
    docker compose up -d --build
fi

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 5

echo "üóÑÔ∏è  –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)..."
if command -v docker-compose &> /dev/null; then
    docker-compose exec -T backend npm run migrate || echo "‚ö†Ô∏è  –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–∞"
else
    docker compose exec -T backend npm run migrate || echo "‚ö†Ô∏è  –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–∞"
fi

echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
if command -v docker-compose &> /dev/null; then
    docker-compose ps
else
    docker compose ps
fi

echo "üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ backend (–∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç)
if curl -f http://localhost:9000/health > /dev/null 2>&1; then
    echo "‚úÖ Backend health check: OK"
    curl http://localhost:9000/health
else
    echo "‚ùå Backend health check: FAILED"
    echo "üìã –õ–æ–≥–∏ backend:"
    if command -v docker-compose &> /dev/null; then
        docker-compose logs --tail=50 backend
    else
        docker compose logs --tail=50 backend
    fi
    exit 1
fi

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
```

#### 4.2. –ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```bash
chmod +x scripts/deploy.sh
```

### –®–∞–≥ 5: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–µ–ø–ª–æ—è

#### 5.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -p <SSH_PORT> root@<DEPLOY_HOST>

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
mkdir -p /opt/your-project
cd /opt/your-project

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/<user>/<repo>.git .

# –ò–ª–∏ –µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
cd /opt/your-project
git fetch origin
git checkout main
```

#### 5.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª env.prod –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/your-project
cp env.example.txt env.prod

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ env.prod —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
nano env.prod
```

#### 5.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker --version
docker compose version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Docker
docker ps
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ build –ø—Ä–∏ push:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. **Settings** ‚Üí **Webhooks** ‚Üí **Add webhook**
3. **Payload URL**: `http://<JENKINS_HOST>:<PORT>/github-webhook/`
4. **Content type**: `application/json`
5. **Events**: `Just the push event`
6. **Active**: ‚úÖ
7. **Add webhook**

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ Jenkins Job:
- **Build Triggers** ‚Üí **GitHub hook trigger for GITScm polling**

### –®–∞–≥ 7: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

#### 7.1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Jenkins UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ Job –≤ Jenkins
2. –ù–∞–∂–º–∏—Ç–µ **Build Now**
3. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –≤ **Console Output**

#### 7.2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç trigger-jenkins-build.sh
JENKINS_URL="http://<JENKINS_HOST>:<PORT>"
JENKINS_USER="<username>"
JENKINS_TOKEN="<api_token>"
JOB_NAME="<project-name>-deploy"

curl -X POST \
  "${JENKINS_URL}/job/${JOB_NAME}/build" \
  --user "${JENKINS_USER}:${JENKINS_TOKEN}"
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Jenkins Pipeline

```bash
# –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
curl -s -u <user>:<token> \
  "http://<JENKINS_HOST>:<PORT>/job/<job-name>/lastBuild/api/json?tree=number,result,building"

# –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ build
curl -s -u <user>:<token> \
  "http://<JENKINS_HOST>:<PORT>/job/<job-name>/lastBuild/consoleText" | tail -50
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh -p <SSH_PORT> root@<DEPLOY_HOST> "cd /opt/your-project && docker compose ps"

# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh -p <SSH_PORT> root@<DEPLOY_HOST> "cd /opt/your-project && docker compose logs --tail=50"

# Health check
ssh -p <SSH_PORT> root@<DEPLOY_HOST> "curl http://localhost:9000/health"
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Could not find credentials entry"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID credentials –≤ Jenkinsfile (`jenkins-ssh-deploy-key`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ credentials —Å–æ–∑–¥–∞–Ω—ã —Å —Ç–∞–∫–∏–º –∂–µ ID
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Scope credentials (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Global)

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied (publickey)"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh -i ~/.ssh/id_ed25519 -p <PORT> root@<HOST> "cat ~/.ssh/authorized_keys | grep <your-key>"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á
chmod 600 ~/.ssh/id_ed25519
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Host key verification failed"

**–†–µ—à–µ–Ω–∏–µ:**
- –í Jenkinsfile —É–∂–µ –µ—Å—Ç—å `-o StrictHostKeyChecking=no`
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Å—Ç –≤ known_hosts –Ω–∞ Jenkins —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "docker-compose: not found"

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker compose` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞) –≤ —Å–∫—Ä–∏–ø—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞: Build –∑–∞–≤–∏—Å–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –≤ Jenkinsfile (—É–≤–µ–ª–∏—á—å—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è –¥–æ—Å—Ç—É–ø–µ–Ω

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Jenkinsfile

```groovy
post {
    success {
        script {
            echo "‚úÖ Pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
            // –î–æ–±–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
            // - Telegram bot
            // - Slack webhook
            // - Email notification
        }
    }
    failure {
        script {
            echo "‚ùå Pipeline –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
        }
    }
}
```

### –ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

```groovy
sh """
    curl -s -X POST "https://api.telegram.org/bot<BOT_TOKEN>/sendMessage" \\
        -d "chat_id=<CHAT_ID>" \\
        -d "text=‚úÖ Build #${env.BUILD_NUMBER} —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!"
"""
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **SSH –∫–ª—é—á–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è Jenkins
   - –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
   - –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏

2. **Credentials:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Jenkins Credentials Store
   - –ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å—Ç–µ –ø–∞—Ä–æ–ª–∏/—Ç–æ–∫–µ–Ω—ã –≤ Jenkinsfile
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ credentials

3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `env.prod` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª—ã
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.gitignore`

4. **–°–µ—Ç—å:**
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Jenkins UI
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è Jenkins
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ builds
curl -s -u <user>:<token> \
  "http://<JENKINS_HOST>:<PORT>/job/<job-name>/api/json?tree=builds[number,result,url]"

# –û—Ç–º–µ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ build
curl -X POST -u <user>:<token> \
  "http://<JENKINS_HOST>:<PORT>/job/<job-name>/<build-number>/stop"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ failed build
curl -X POST -u <user>:<token> \
  "http://<JENKINS_HOST>:<PORT>/job/<job-name>/<build-number>/rebuild"
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project-root/
‚îú‚îÄ‚îÄ Jenkinsfile                 # Jenkins pipeline –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml          # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore                  # Git ignore –ø—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh              # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
‚îÇ   ‚îî‚îÄ‚îÄ check-server.sh        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile             # Dockerfile –¥–ª—è backend
‚îî‚îÄ‚îÄ frontend/
    ‚îî‚îÄ‚îÄ Dockerfile             # Dockerfile –¥–ª—è frontend
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è
- [ ] SSH credentials —Å–æ–∑–¥–∞–Ω—ã –≤ Jenkins
- [ ] Jenkins –ø–ª–∞–≥–∏–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Jenkinsfile —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] scripts/deploy.sh —Å–æ–∑–¥–∞–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è
- [ ] env.prod –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] Pipeline Job —Å–æ–∑–¥–∞–Ω –≤ Jenkins
- [ ] –ü–µ—Ä–≤—ã–π build –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] GitHub Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CI/CD pipeline, –∫–æ—Ç–æ—Ä—ã–π:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç—É—Å

**–í—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** ~30-60 –º–∏–Ω—É—Ç (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–ø—ã—Ç–∞)

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting –∏–ª–∏ –ª–æ–≥–∏ Jenkins.

