# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Jenkins Pipeline - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ

## üéØ –ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞?

**–°–±–æ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ù–ê –°–ï–†–í–ï–†–ï –î–ï–ü–õ–û–Ø, –∞ –Ω–µ –Ω–∞ Jenkins!**

```{mermaid}
graph TD
    A[Git Push] --> B[Jenkins Agent]
    B --> C[Checkout –∫–æ–¥–∞]
    C --> D[SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É]
    D --> E[–°–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è]
    E --> F[git pull –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ]
    F --> G[docker compose build]
    G --> H[docker compose up]
    H --> I[‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç]
    
    style B fill:#e1f5ff
    style E fill:#fff4e6
    style I fill:#d4edda
```

---

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### 1. **Jenkins Agent** (–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Jenkins –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–≤–æ–π agent
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Jenkinsfile
- **–ù–ï —Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã** (–Ω–∞ Jenkins agent –Ω–µ—Ç Docker)

**–ì–¥–µ:** `/var/jenkins_home/workspace/personal-page-deploy/`

**–ß—Ç–æ —Ç–∞–º:**
- –ö–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- Jenkinsfile
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

### 2. **–°–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è** (–≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Jenkins –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
  1. `git pull` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
  2. `docker compose build` - **–°–ë–û–†–ö–ê –û–ë–†–ê–ó–û–í**
  3. `docker compose up -d` - –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  4. `npm run migrate` - –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–ì–¥–µ:** `7eb10d5af2ad.vps.myjino.ru:49233` ‚Üí `/opt/personal-page/`

**–ß—Ç–æ —Ç–∞–º:**
- –í–µ—Å—å –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
- Docker –æ–±—Ä–∞–∑—ã (—Å–æ–±—Ä–∞–Ω–Ω—ã–µ)
- –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä Jenkinsfile

### –≠—Ç–∞–ø 1: Checkout
```groovy
stage('Checkout') {
    // –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ Jenkins agent
    // –ù–ï —Å–æ–±–∏—Ä–∞–µ—Ç –Ω–∏—á–µ–≥–æ!
}
```

**–ì–¥–µ:** Jenkins agent (`/var/jenkins_home/workspace/...`)

---

### –≠—Ç–∞–ø 2: Validate
```groovy
stage('Validate') {
    // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Jenkinsfile
    // –ù–ï —Å–æ–±–∏—Ä–∞–µ—Ç –Ω–∏—á–µ–≥–æ!
}
```

**–ì–¥–µ:** Jenkins agent

---

### –≠—Ç–∞–ø 3: Deploy (–ó–î–ï–°–¨ –ü–†–û–ò–°–•–û–î–ò–¢ –°–ë–û–†–ö–ê!)
```groovy
stage('Deploy') {
    // –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
    ssh -p 49233 root@7eb10d5af2ad.vps.myjino.ru
    
    // –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
    cd /opt/personal-page
    git pull                    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
    docker compose build        # ‚Üê –°–ë–û–†–ö–ê –û–ë–†–ê–ó–û–í –ó–î–ï–°–¨!
    docker compose up -d       # ‚Üê –ó–ê–ü–£–°–ö –ö–û–ù–¢–ï–ô–ù–ï–†–û–í –ó–î–ï–°–¨!
}
```

**–ì–¥–µ:** –°–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è (`/opt/personal-page/`)

---

## üê≥ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: `/opt/personal-page/`

```
/opt/personal-page/
‚îú‚îÄ‚îÄ frontend/          # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ frontend
‚îú‚îÄ‚îÄ backend/           # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ backend
‚îú‚îÄ‚îÄ docker-compose.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ .env              # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ data/             # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
```

### –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏:

1. **`docker compose build`** —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã:
   - `frontend` ‚Üí –æ–±—Ä–∞–∑ —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
   - `backend` ‚Üí –æ–±—Ä–∞–∑ —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

2. **`docker compose up -d`** –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   - Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8888
   - Backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 9000

3. **–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ–±—Ä–∞–∑—ã:**
   - –í Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker images`
   - –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å: `ssh root@7eb10d5af2ad.vps.myjino.ru -p 49233 "docker images"`

---

## üìä –°—Ö–µ–º–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

```{mermaid}
sequenceDiagram
    participant Dev as –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
    participant Git as GitHub
    participant Jenkins as Jenkins Agent
    participant Server as –°–µ—Ä–≤–µ—Ä –¥–µ–ø–ª–æ—è
    
    Dev->>Git: git push
    Git->>Jenkins: Webhook/Poll
    Jenkins->>Git: git clone (–∫–æ–¥)
    Git-->>Jenkins: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
    Jenkins->>Server: SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    Server->>Git: git pull (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
    Git-->>Server: –ù–æ–≤—ã–π –∫–æ–¥
    Server->>Server: docker compose build
    Note over Server: –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤<br/>frontend + backend
    Server->>Server: docker compose up
    Note over Server: –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    Server-->>Jenkins: ‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞

### –ù–∞ Jenkins agent:
```bash
# –≠—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞ Jenkins agent –Ω–µ—Ç Docker
# –ù–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–¥ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω:
curl -s -u ferrpoint:TOKEN \
  "http://192.168.1.49:32768/job/personal-page-deploy/workspace/"
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è:
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -p 49233 root@7eb10d5af2ad.vps.myjino.ru

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /opt/personal-page
ls -la

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã
docker images | grep personal-page

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose ps
# –∏–ª–∏
docker ps
```

---

## ‚úÖ –ò—Ç–æ–≥–æ

**–°–±–æ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚ùå –ù–ï –Ω–∞ Jenkins agent
- ‚úÖ **–ù–ê –°–ï–†–í–ï–†–ï –î–ï–ü–õ–û–Ø** (`7eb10d5af2ad.vps.myjino.ru`)

**Jenkins —Ç–æ–ª—å–∫–æ:**
- –ö–ª–æ–Ω–∏—Ä—É–µ—Ç –∫–æ–¥
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–í—Å—è —Ä–µ–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (—Å–±–æ—Ä–∫–∞, –∑–∞–ø—É—Å–∫) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!**

---

## üõ†Ô∏è –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ Jenkinsfile –≤ —ç—Ç–∞–ø–µ `Deploy`:

```groovy
stage('Deploy') {
    // –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ù–ê –°–ï–†–í–ï–†–ï:
    git pull
    docker compose build
    docker compose up -d
    npm run migrate
}
```

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/opt/personal-page/` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ø–ª–æ—è.

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Jenkins –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, —á—Ç–æ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç!

