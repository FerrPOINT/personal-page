# Jenkins CI/CD - –ë—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

### 1. SSH –∫–ª—é—á
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª—é—á –¥–ª—è Jenkins credentials
cat ~/.ssh/id_ed25519

# –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/id_ed25519.pub -p <PORT> root@<HOST>
```

### 2. Jenkins Credentials
- **ID**: `jenkins-ssh-deploy-key`
- **Kind**: SSH Username with private key
- **Username**: `root`
- **Private Key**: –≤—Å—Ç–∞–≤–∏—Ç—å –∏–∑ —à–∞–≥–∞ 1

### 3. Jenkinsfile –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```groovy
DEPLOY_HOST = 'your-server.com'
DEPLOY_PORT = '22'
DEPLOY_USER = 'root'
DEPLOY_PATH = '/opt/your-project'
COMPOSE_PROJECT_NAME = 'your-project'
credentialsId: 'jenkins-ssh-deploy-key'  // ‚ö†Ô∏è –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å!
```

### 4. –°–∫—Ä–∏–ø—Ç deploy.sh
```bash
#!/bin/bash
set -e
cp env.prod .env || true
docker compose down || true
docker compose up -d --build
sleep 5
docker compose exec -T backend npm run migrate || true
curl -f http://localhost:9000/health || exit 1
```

### 5. –°–µ—Ä–≤–µ—Ä
```bash
ssh root@<HOST> "cd /opt/your-project && git clone <repo> . && cp env.example.txt env.prod"
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç

- [ ] SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω
- [ ] Credentials –≤ Jenkins (ID: `jenkins-ssh-deploy-key`)
- [ ] Jenkinsfile –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] scripts/deploy.sh —Å–æ–∑–¥–∞–Ω (`chmod +x`)
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] env.prod –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –ü–µ—Ä–≤—ã–π build —É—Å–ø–µ—à–µ–Ω

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –°—Ç–∞—Ç—É—Å build
curl -s -u user:token \
  "http://jenkins/job/job-name/lastBuild/api/json?tree=result"

# –õ–æ–≥–∏
curl -s -u user:token \
  "http://jenkins/job/job-name/lastBuild/consoleText" | tail -50

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@host "cd /opt/project && docker compose ps"
```

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `Could not find credentials` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤ Jenkinsfile |
| `Permission denied` | –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä |
| `docker-compose: not found` | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker compose` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞) |
| Build –∑–∞–≤–∏—Å–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ |

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `info/jenkins-cicd-setup-guide.qmd` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

